{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Make-Up Class Management</title>
<style>
body { font-family: Arial, sans-serif; background:#0f1419; color:#f1f5f9; margin:0; }
.layout { display:flex; }
.sidebar { width:250px; background:#1a1f2e; height:100vh; padding:20px; }
.sidebar a { display:block; padding:10px; color:#cbd5e1; text-decoration:none; margin-bottom:5px; }
.sidebar a.active { background:#242d3d; color:#3b82f6; }
.main-content { flex:1; padding:30px; }
.metric-card { background:#1a1f2e; padding:20px; border-radius:8px; margin-bottom:20px; }
.metrics-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
td { padding:10px; border-bottom:1px solid #334155; }
</style>
</head>

<body>
<div class="layout">

<div class="sidebar">
    <h3>Make-Up Classes</h3>
    <a href="{% url 'dashboard' %}" class="active">Dashboard</a>
    <a href="{% url 'faculty' %}">Faculty Control</a>
    <a href="{% url 'student' %}">Student Portal</a>
    <a href="{% url 'ai' %}">AI Insights</a>
    <a href="{% url 'admin_logout' %}">Logout</a>
</div>

<div class="main-content">

<h1>Dashboard Overview</h1>

<!-- ===== METRICS ===== -->
<div class="metrics-grid" id="metricsGrid"></div>

<!-- ===== RECENT ACTIVITY ===== -->
<h2>Recent Activity</h2>
<table>
<tbody id="recentActivityBody"></tbody>
</table>

</div>
</div>

<script>

// ==========================
// LOAD DASHBOARD DATA
// ==========================
async function loadDashboard() {
    try {
        const response = await fetch("/api/dashboard/");
        const data = await response.json();

        // Metrics
        document.getElementById("metricsGrid").innerHTML = `
            <div class="metric-card">
                <h3>Total Classes</h3>
                <p>${data.total_classes}</p>
            </div>

            <div class="metric-card">
                <h3>Total Students</h3>
                <p>${data.total_students}</p>
            </div>

            <div class="metric-card">
                <h3>Total Attendance</h3>
                <p>${data.total_attendance}</p>
            </div>

            <div class="metric-card">
                <h3>Attendance Rate</h3>
                <p>${data.attendance_rate}%</p>
            </div>
        `;

        // Recent Activity (DB Driven)
        const tbody = document.getElementById("recentActivityBody");
        tbody.innerHTML = "";

        data.recent_activity.forEach(activity => {
            tbody.innerHTML += `
                <tr>
                    <td>${activity.subject}</td>
                    <td style="text-align:right; color:#94a3b8;">
                        ${activity.date}
                    </td>
                </tr>
            `;
        });

    } catch (error) {
        console.error("Dashboard Load Error:", error);
    }
}

document.addEventListener("DOMContentLoaded", loadDashboard);

</script>

</body>
</html>